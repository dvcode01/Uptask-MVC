(()=>{const e=document.querySelector("#agregar-tarea"),t=document.querySelector(".dashboard");let a=[],o=[];!async function(){try{const e=d(),t=`${location.origin}/api/tareas?id=${e}`,o=await fetch(t),n=await o.json();a=n.tareas,r()}catch(e){console.log(e)}}(),e.addEventListener("click",()=>{i()});function n(e){const t=e.target.value;o=""!==t?a.filter(e=>e.estado===t):[],r()}function r(){!function(){const e=document.querySelector("#listado-tareas");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const e=a.filter(e=>"0"===e.estado),t=document.querySelector("#pendientes");0===e.length?t.disabled=!0:t.disabled=!1}(),function(){const e=a.filter(e=>"1"===e.estado),t=document.querySelector("#completadas");0===e.length?t.disabled=!0:t.disabled=!1}();const e=o.length?o:a,t=document.querySelector("#listado-tareas");if(0===e.length){const e=document.createElement("li");return e.textContent="No hay Tareas",e.classList.add("no-tareas"),void t.appendChild(e)}const n={0:"Pendiente",1:"Completada"};e.forEach(e=>{const o=document.createElement("li");o.dataset.tareaId=e.id,o.classList.add("tarea");const l=document.createElement("p");l.textContent=e.nombre,l.ondblclick=()=>{i(!0,{...e})};const m=document.createElement("div");m.classList.add("opciones");const u=document.createElement("button");u.classList.add("estado-tarea"),u.classList.add(`${n[e.estado]}`.toLowerCase()),u.textContent=n[e.estado],u.dataset.estadoTarea=e.estado,u.ondblclick=()=>{!function(e){const t="1"===e.estado?"0":"1";e.estado=t,c(e)}({...e})};const p=document.createElement("button");p.classList.add("eliminar-tarea"),p.dataset.idTarea=e.id,p.textContent="Eliminar",p.ondblclick=()=>{!function(e){Swal.fire({title:"多Estas seguro de eliminar esta tarea?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&async function(e){const{id:t,nombre:o,estado:n}=e,i=new FormData;i.append("id",t),i.append("nombre",o),i.append("estado",n),i.append("proyecto_id",d());try{const t=`${location.origin}/api/tarea/eliminar`,o=await fetch(t,{method:"POST",body:i}),n=await o.json();n.resultado&&(s(n.tipo,n.mensaje,document.querySelector(".contenedor-nueva-tarea")),a=a.filter(t=>t.id!==e.id),r())}catch(e){console.log(e)}}(e)})}({...e})},m.appendChild(u),m.appendChild(p),o.appendChild(l),o.appendChild(m),t.appendChild(o)})}function i(e=!1,o={}){const n=document.createElement("div");n.classList.add("modal"),n.innerHTML=`\n            <form class="formulario nueva-tarea" >\n                <legend>${e?"Editar Tarea":"A単ade una nueva tarea"}</legend>\n\n                <div class="campo">\n                    <label for="tarea">Tarea</label>\n                    <input \n                        type="text" \n                        name="tarea" \n                        id="tarea"\n                        value="${o.nombre?o.nombre:""}"\n                        placeholder="${o.nombre?"Edita la tarea":"A単adir tarea al proyecto actual"}" />\n                </div>\n\n                <div class="opciones">\n                    <input type="submit" class="submit-tarea" value="${o.nombre?"Guardar cambios":"A単adir tarea"}" />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("show")},1e3),n.addEventListener("click",t=>{!function(e,t,o=!1,n={}){if(e.preventDefault(),e.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("close"),setTimeout(()=>{t.remove()},500)}if(e.target.classList.contains("submit-tarea")){const e=document.querySelector("#tarea").value.trim();if(""===e)return void s("error","El nombre de la tarea es obligatorio",document.querySelector(".formulario legend"));o?(n.nombre=e,c(n)):async function(e){const t=`${location.origin}/api/tarea`,o=new FormData;o.append("nombre",e),o.append("proyecto_id",d());try{const n=await fetch(t,{method:"POST",body:o}),i=await n.json();if(s(i.tipo,i.mensaje,document.querySelector(".formulario legend")),"exito"===i.tipo){const t=document.querySelector(".modal");setTimeout(()=>{t.remove()},3e3);const o={id:String(i.id),nombre:e,estado:"0",proyecto_id:i.proyecto_id};a=[...a,o],r()}}catch(e){console.log(e)}}(e)}}(t,n,e,o)}),t.appendChild(n)}async function c(e){const{id:t,nombre:o,estado:n}=e,i=new FormData;i.append("id",t),i.append("nombre",o),i.append("estado",n),i.append("proyecto_id",d());try{const e=`${location.origin}/api/tarea/actualizar`,c=await fetch(e,{method:"POST",body:i}),d=await c.json();"exito"===d.tipo&&Swal.fire(d.mensaje,d.mensaje,"success");const s=document.querySelector(".modal");s&&s.remove(),a=a.map(e=>(e.id===t&&(e.estado=n,e.nombre=o),e)),r()}catch(e){console.log(e)}}function d(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}function s(e,t,a){const o=document.querySelector(".alerta");o&&o.remove();const n=document.createElement("div");n.classList.add("alerta",e),n.textContent=t,a.parentElement.insertBefore(n,a.nextElementSibling),setTimeout(()=>{n.remove()},5e3)}document.querySelectorAll('#filtros input[type="radio"]').forEach(e=>{e.addEventListener("input",n)})})();